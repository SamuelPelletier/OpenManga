{% set folder = manga.isOld ? 'media_old' : 'media' %}
{% extends 'base.html.twig' %}
{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('css/show') }}
{% endblock %}

{% block title %}{{ manga.title }}{% endblock %}

{% block meta_description %}
    {{ 'meta.description.manga'|trans ~ manga.title | raw  ~ 'meta.description.with'|trans }} {{ manga.tags | join(',',' and ') }}
{% endblock %}

{% block meta_keyword %}
    {% if manga.tags.count > 0 %}
        {{ manga.tags | join(',') }}
    {% else %}
        {{ parent() }}
    {% endif %}
{% endblock %}

{% block main %}
    <h1>{{ manga.title | raw }}</h1>
    <p id="description-toggle" data-umami-event="see-more">{{ 'manga.see_more'|trans }}</p>
    <div id="manga-description" class="manga-description">
        <p class="manga-metadata">
            <span class="metadata"><i
                        class="fa fa-calendar-alt"></i> {{ manga.publishedAt|format_datetime('long', 'none') }}</span>
        </p>
        
        <p class="count-views">{{ 'manga.count_views'|trans }} : {{ manga.countViews }} <i class="fa fa-eye"></i></p>

    </div>
    <div id="download-container">
        <a class="btn-effect raise download" data-umami-event="download" target="_blank"
           href="{{ url('download', {'id':manga.id}) }}"><i
                    class="fa fa-download "></i> {{ 'manga.download'|trans }}</a>

        {% if app.user is not null %}
            {% if manga in app.user.getFavoriteMangas %}
                {% set buttonText = 'manga.remove_favorite'|trans %}
                {% set url = url('remove_favorite',{"id":manga.id}) %}
            {% else %}
                {% set buttonText = 'manga.add_favorite'|trans %}
                {% set url = url('add_favorite',{"id":manga.id}) %}
            {% endif %}

            <a class="btn-effect raise add-favorite"
               data-url="{{ url }}"><i class="fa fa-star"> </i>{{ buttonText }}</a>

        {% endif %}
    </div>
    <div class="row" id="lightgallery">
        {% for image in images %}
            {% if image matches '{\.jpg$}' %}
                <article class="image col-sm-2"
                         data-src='{{ app.request.getSchemeAndHttpHost() ~ asset( folder ~ '/' ~ manga.id ~ '/' ~ image ) }}'>
                    <img alt="{{ manga.title | raw }} {{ 'manga.image_alt'|trans({'%count%':loop.index}) }}"
                         title="{{ manga.title | raw }} {{ 'manga.image_alt'|trans({'%count%':loop.index}) }}"
                         class='img-view'
                         src='{{ app.request.getSchemeAndHttpHost() ~ asset( folder ~ '/' ~ manga.id ~ '/' ~ image ) }}'>
                </article>
            {% endif %}
        {% else %}
            <div class="well">{{ 'manga.no_images_found'|trans }}</div>
        {% endfor %}
    </div>
    {% if mangas_recommended is not empty %}
        <div id="recommended">
            <h2>{{ 'manga.recommended'|trans }}</h2>
            <div class="manga-recommended-container" data-umami-event="recommended">
                {% for manga in mangas_recommended %}
                    {% include 'manga.html.twig' %}
                {% endfor %}
            </div>
        </div>
    {% endif %}
    {% block javascripts %}
        {{ parent() }}
        {{ encore_entry_script_tags('show') }}
        <script type="application/ld+json">
            {
                "@context": "https://schema.org",
                "@type": "WebPage",
                "breadcrumb": "Books > Manga",
                "mainEntity": {
                    "@type": "Book",
                    "author": "{{ manga.authors|join(',') }}",
                    "bookFormat": "http://schema.org/EBook",
                    "datePublished": "{{ manga.publishedAt|format_datetime('long', 'none', 'UTC') }}",
                    "thumbnail": "{{ app.request.getSchemeAndHttpHost() ~ asset( folder ~ '/' ~ manga.id ~ '/thumb.webp' ) }}",
                    "inLanguage": "{{ manga.languages|join(',') }}",
                    "name": "{{ manga.title }}",
                    "numberOfPages": "{{ manga.countPages - 1 }}",
                    "publisher": "{{ app.request.server.get('APP_NAME') }}",
                    "aggregateRating": {
                        "@type": "AggregateRating",
                        "reviewCount": "{{ manga.countViews }}",
                        "ratingValue": "5"
                    }
                }
            }


















        </script>
    {% endblock %}
{% endblock %}
